!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var a in n)("object"==typeof exports?exports:e)[a]=n[a]}}(window,function(){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=s(n(1)),i=s(n(2)),l=s(n(3)),r=s(n(4));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){},d=null,f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._init=!1,this._idb=null,this._db=null,this._namespace=null,this._idb_name="BROWSER_FILE_STORAGE_JS",this._idb_version=3,this._idb=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction||{READ_WRITE:"readwrite"},window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange}return a(e,[{key:"logLevel",value:function(e){l.default.logLevel(e)}},{key:"init",value:function(e){var t=(e=e||{}).namespace,n=e.onSuccess||u,a=e.onFail||u;if(d._init)return l.default.log(l.default.LEVEL_ERROR,o.default.IDB_ALREADY_INIT,{}),void a({message:o.default.IDB_ALREADY_INIT,supported:!0});d._namespace=t;var i=t&&"string"==typeof t?d._idb_name+"_"+t:d._idb_name;d._idb?d._opendb(i,function(e,t){if(e)return l.default.log(l.default.LEVEL_ERROR,o.default.IDB_COULD_NOT_OPEN,{err:e}),void a({message:o.default.IDB_COULD_NOT_OPEN,error:e.error,supported:!0});l.default.log(l.default.LEVEL_INFO,o.default.IDB_OPEN_SUCCESS,t||{}),d._init=!0,n({message:o.default.IDB_OPEN_SUCCESS,supported:!0,initial:t.initial,upgrade:t.upgrade,versions:t.versions})},d._idb_version):(l.default.log(l.default.LEVEL_ERROR,o.default.IDB_NOT_SUPPORTED,{}),a({message:o.default.IDB_NOT_SUPPORTED,supported:!1}))}},{key:"_opendb",value:function(e,t,n){var a=null,i=!1,r=!1,s={old:null,new:null};(a=n?d._idb.open(e,n):d._idb.open(e)).onerror=function(e){t({error:a.error,event:e,request:a})},a.onsuccess=function(e){d._db=a.result,t(null,{db:a.result,request:a,event:e,upgrade:i,initial:r,versions:s})},a.onupgradeneeded=function(e){i=!0,l.default.log(l.default.LEVEL_WARN,o.default.IDB_WILL_UPGRADE,{}),d._db=e.target.result;var t=e.target.transaction;function n(e,t,n){e.indexNames.contains(t)||e.createIndex(t,t,n)}var a=void 0;0!=e.oldVersion&&e.oldVersion!=e.newVersion?(s.old=e.oldVersion,s.new=e.newVersion,a=t.objectStore("files")):(r=!0,a=d._db.createObjectStore("files",{keyPath:"filename"})),n(a,"filename",{unique:!1}),n(a,"modified",{unique:!1})}}},{key:"persist",value:function(e){var t=(e=e||{}).onSuccess||u,n=e.onFail||u;if(!d._init)return l.default.log(l.default.LEVEL_ERROR,o.default.IDB_NOT_INIT,{method:"persist"}),void n({message:o.default.IDB_NOT_INIT,method:"persist"});navigator.storage&&navigator.storage.persist?navigator.storage.persist().then(function(e){e?(l.default.log(l.default.LEVEL_INFO,o.default.IDB_PERSIST_PASS,{}),t({message:o.default.IDB_PERSIST_PASS,persistent:!0})):(l.default.log(l.default.LEVEL_WARN,o.default.IDB_PERSIST_FAIL,{}),n({message:o.default.IDB_PERSIST_FAIL,canPersist:!0}))}):(l.default.log(l.default.LEVEL_ERROR,o.default.IDB_PERSIST_NONE,{}),n({message:o.default.IDB_PERSIST_NONE,canPersist:!1}))}},{key:"save",value:function(e){var t=(e=e||{}).onSuccess||u,n=e.onFail||u,a=e.contents,i=e.filename,r=e.mimeType;if(!d._init)return l.default.log(l.default.LEVEL_ERROR,o.default.IDB_NOT_INIT,{method:"save"}),void n({message:o.default.IDB_NOT_INIT});if(!i||"string"!=typeof i||i.length<1)return l.default.log(l.default.LEVEL_ERROR,o.default.IDB_BAD_FILENAME,{errors:{filename:!0}}),void n({message:o.default.IDB_BAD_FILENAME,errors:{filename:!0}});if(!a)return l.default.log(l.default.LEVEL_ERROR,o.default.IDB_NO_CONTENT,{errors:{filename:!1,contents:!0}}),void n({message:o.default.IDB_NO_CONTENT,errors:{filename:!1,contents:!0}});var s=d._createFileToSave({filename:i,contents:a,mimeType:r});if(!s)return l.default.log(l.default.LEVEL_ERROR,o.default.IDB_WRONG_CONTENT,{errors:{filename:!1,contents:!0,parseToBlob:!0}}),void n({message:o.default.IDB_WRONG_CONTENT,errors:{filename:!1,contents:!0,parseToBlob:!0}});var f=d._db.transaction(["files"],IDBTransaction.READ_WRITE||"readwrite").objectStore("files").put(s._toIDB());f.onsuccess=function(e){l.default.log(l.default.LEVEL_INFO,o.default.IDB_SAVE_SUCCESS,{event:e}),t({message:o.default.IDB_SAVE_SUCCESS,event:e})},f.onerror=function(e){l.default.log(l.default.LEVEL_ERROR,o.default.IDB_SAVE_FAIL,{event:e}),n({message:o.default.IDB_SAVE_FAIL,event:e,errors:{db:!0}})}}},{key:"load",value:function(e){var t=(e=e||{}).onSuccess||u,n=e.onFail||u,a=e.filename;if(!d._init)return l.default.log(l.default.LEVEL_ERROR,o.default.IDB_NOT_INIT,{method:"load"}),void n({message:o.default.IDB_NOT_INIT});if(!a||"string"!=typeof a||a.length<1)return l.default.log(l.default.LEVEL_ERROR,o.default.IDB_BAD_FILENAME,{method:"load",filename:a}),void n({message:o.default.IDB_BAD_FILENAME,errors:{filename:!0}});var i=d._db.transaction(["files"]).objectStore("files").get(a);i.onsuccess=function(e){if(i.result){var a=new r.default(i.result);l.default.log(l.default.LEVEL_INFO,o.default.IDB_LOAD_SUCCESS,{file:a,event:e,request:i}),t(a,{event:e,request:i})}else l.default.log(l.default.LEVEL_ERROR,o.default.IDB_LOAD_FIND_FAIL,{event:e,request:i,errors:{notFound:!0}}),n({message:o.default.IDB_LOAD_FIND_FAIL,event:e,request:i,errors:{notFound:!0}})},i.onerror=function(e){l.default.log(l.default.LEVEL_ERROR,o.default.IDB_LOAD_FAIL,{event:e,request:i,errors:{db:!0}}),n({message:o.default.IDB_LOAD_FAIL,event:e,request:i,errors:{db:!0}})}}},{key:"loadAll",value:function(e){var t=(e=e||{}).onSuccess||u,n=e.onFail||u;if(!d._init)return l.default.log(l.default.LEVEL_ERROR,o.default.IDB_NOT_INIT,{method:"loadAll"}),void n({message:o.default.IDB_NOT_INIT});var a=d._db.transaction(["files"],IDBTransaction.READ_WRITE||"readwrite").objectStore("files");if(a.getAll){var i=a.getAll();i.onsuccess=function(e){var n=[];if(e.target.result[0])for(var a in e.target.result)e.target.result[a]&&e.target.result[a].filename&&n.push(new r.default(e.target.result[a]));else e.target.result&&e.target.result.filename&&n.push(new r.default(e.target.result));l.default.log(l.default.LEVEL_INFO,o.default.IDB_LOAD_ALL_SUCCESS,{files:n,event:e,request:i}),t(n,{message:o.default.IDB_LOAD_ALL_SUCCESS,event:e,request:i})},i.onerror=function(e){l.default.log(l.default.LEVEL_ERROR,o.default.IDB_LOAD_ALL_FAIL,{event:e,request:i,errors:{db:!0}}),n({message:o.default.IDB_LOAD_ALL_FAIL,event:e,request:i,errors:{db:!0}})}}else{var s=[],f=a.openCursor();f.onsuccess=function(e){var n=e.target.result;n?(n.value&&n.value.filename&&s.push(new r.default(n.value)),n.continue()):(l.default.log(l.default.LEVEL_INFO,o.default.IDB_LOAD_ALL_SUCCESS,{files:s,event:e,request:f}),t(s,{message:o.default.IDB_LOAD_ALL_SUCCESS,event:e,request:f}))},f.onerror=function(e){l.default.log(l.default.LEVEL_ERROR,o.default.IDB_LOAD_ALL_FAIL,{event:e,request:f,errors:{db:!0}}),n({message:o.default.IDB_LOAD_ALL_FAIL,event:e,request:f,errors:{db:!0}})}}}},{key:"delete",value:function(e){var t=(e=e||{}).onSuccess||u,n=e.onFail||u,a=e.filename;if(!d._init)return l.default.log(l.default.LEVEL_ERROR,o.default.IDB_NOT_INIT,{method:"delete"}),void n({message:o.default.IDB_NOT_INIT});if(!a||"string"!=typeof a||a.length<1)return l.default.log(l.default.LEVEL_ERROR,o.default.IDB_BAD_FILENAME,{errors:{filename:!0}}),void n({message:o.default.IDB_BAD_FILENAME,errors:{filename:!0}});var i=this._db.transaction(["files"],IDBTransaction.READ_WRITE||"readwrite"),r=i.objectStore("files").delete(a);i.oncomplete=function(e){l.default.log(l.default.LEVEL_INFO,o.default.IDB_DELETE_SUCCESS,{event:e,request:r,transaction:i}),t({message:o.default.IDB_DELETE_SUCCESS,event:e,request:r,transaction:i})},i.onerror=function(e){l.default.log(l.default.LEVEL_ERROR,o.default.IDB_DELETE_FAIL,{error:i.error,event:e,request:r}),n({message:o.default.IDB_DELETE_FAIL,error:i.error,event:e,request:r})}}},{key:"_createFileToSave",value:function(e){var t=e.filename,n=e.contents,a=e.mimeType;a&&"string"==typeof a&&""!=a||(a=null);var i=this._getExtension(t),s=this._getMimeType(i),u=a&&"string"==typeof a&&""!=a?a:null,d=null;if("string"==typeof n)u?d=new Blob([n],{type:u}):i&&s?d=new Blob([n],{type:s}):(l.default.log(l.default.LEVEL_WARN,o.default.NO_MIME_TYPE,{filename:t,contents:n,mimeType:a,method:"_createBlobToSave"}),d=new Blob([n],{type:"text/plain"}));else{if(!(n instanceof Blob))return null;""==n.type?u?d=new Blob([n],{type:u}):s?d=new Blob([n],{type:s}):(l.default.log(l.default.LEVEL_WARN,o.default.NO_MIME_TYPE,{filename:t,contents:n,mimeType:a,method:"_createBlobToSave"}),d=new Blob([n],{type:"application/octet-stream"})):d=u?n:new Blob([n],{type:u})}return new r.default({filename:t,blob:d,lastModified:(new Date).getTime(),extension:i,size:d.size})}},{key:"_getExtension",value:function(e){var t=null;return-1!=e.indexOf(".")&&(t=e.split(".").pop().toLowerCase()).length<=2&&(t=null),t}},{key:"_getMimeType",value:function(e){var t=null;return e&&(t=i.default[e]),t}}]),e}();d=new f,"undefined"!=typeof window&&(window.browserFileStorage=d),t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={IDB_NOT_SUPPORTED:"Indexed DB is not supported on this browser.",IDB_NOT_INIT:"Indexed DB was not initialized. Could not call method.",IDB_ALREADY_INIT:"Indexed DB was already initialized.",IDB_OPEN_SUCCESS:"Indexed DB Opened successfully.",IDB_WILL_UPGRADE:"About to upgrade inner database structure.",IDB_PERSIST_PASS:"Asked for persistency and succeeded. Files will remain until user manually clears them.",IDB_PERSIST_FAIL:"Asked for persistency and failed. Files have default persistency, browser could remove them.",IDB_PERSIST_NONE:"Could not ask for persistency. Files have default persistency, browser could remove them.",IDB_BAD_FILENAME:"Filename is not a string, or is empty.",IDB_NO_CONTENT:"No Content specified.",IDB_WRONG_CONTENT:"Content given is not a string nor blob",IDB_SAVE_SUCCESS:"Successfully saved a file to database.",IDB_SAVE_FAIL:"Failed at saving file to database.",IDB_LOAD_SUCCESS:"Successfully loaded a file from database.",IDB_LOAD_FIND_FAIL:"Could not find the file in the database.",IDB_LOAD_FAIL:"Failed at loading file from database.",IDB_LOAD_ALL_SUCCESS:"Successfully loaded all files from database.",IDB_LOAD_ALL_FAIL:"Could not load all files from the database.",NO_MIME_TYPE:"Cannot auto-detect mimetype for filename, setting mimetype to a safe default type"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={aac:"audio/aac",abw:"application/x-abiword",arc:"application/octet-stream",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",es:"application/ecmascript",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",js:"application/javascript",json:"application/json",mid:"audio/midi",mpeg:"video/mpeg",mp4:"video/mp4",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",otf:"font/otf",png:"image/png",pdf:"application/pdf",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/x-rar-compressed",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tiff:"image/tiff",tif:"image/tiff",ts:"application/typescript",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={DEFAULT_LEVEL:1,LEVEL_NONE:0,LEVEL_ERROR:1,LEVEL_WARN:2,LEVEL_INFO:3,PREFIX:"Browser File Storage - "};a._logLevel=a.DEFAULT_LEVEL,a.log=function(e,t,n){a._logLevel>=e&&console.log(a.PREFIX+t,n)},a.logLevel=function(e){"number"==typeof e?a._logLevel=e:"string"==typeof e?"none"==e?a._logLevel=a.LEVEL_NONE:"error"==e?a._logLevel=a.LEVEL_ERROR:"warn"==e?a._logLevel=a.LEVEL_WARN:"info"==e&&(a._logLevel=a.LEVEL_INFO):a._logLevel=a.DEFAULT_LEVEL},t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.filename=t.filename,this.lastModified=t.lastModified,this.blob=t.blob,this.extension=t.extension,this.size=t.size}return a(e,[{key:"_toIDB",value:function(){return{filename:this.filename,lastModified:this.lastModified,blob:this.blob,extension:this.extension,size:this.size}}},{key:"createURL",value:function(){return this._createdURL?this._createdURL:(this._createdURL=URL.createObjectURL(this.blob),this._createdURL)}},{key:"destroyURL",value:function(){this._createdURL&&(URL.revokeObjectURL(this._createdURL),this._createdURL=null)}}]),e}();t.default=o}])});