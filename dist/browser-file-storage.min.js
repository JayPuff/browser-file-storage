!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var a in n)("object"==typeof exports?exports:e)[a]=n[a]}}(window,function(){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=u(n(1)),o=u(n(2)),r=u(n(3)),l=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var s=function(){},d=null,f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._init=!1,this._idb=null,this._db=null,this._namespace=null,this._idb_name="BROWSER_FILE_STORAGE_JS",this._idb_version=3,this._idb=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction||{READ_WRITE:"readwrite"},window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange}return a(e,[{key:"logLevel",value:function(e){r.default.logLevel(e)}},{key:"init",value:function(e){return new Promise(function(t,n){if(d._init)return r.default.log(r.default.LEVEL_ERROR,i.default.IDB_ALREADY_INIT,{}),n({alreadyInit:!0,supported:!0});if(!d._idb)return r.default.log(r.default.LEVEL_ERROR,i.default.IDB_NOT_SUPPORTED,{}),n({supported:!1});var a=e&&"string"==typeof e?d._idb_name+"_"+e:d._idb_name;d._opendb(a,function(e,a){return e?(r.default.log(r.default.LEVEL_ERROR,i.default.IDB_COULD_NOT_OPEN,{dbError:!0,errorText:e.error,e:e}),n({dbError:!0,errorText:e.error,supported:!0})):(d._init=!0,r.default.log(r.default.LEVEL_INFO,i.default.IDB_OPEN_SUCCESS,{}),t({initial:a.initial,supported:!0}))},d._idb_version)})}},{key:"_opendb",value:function(e,t,n){var a=null,o=!1,l=!1,u={old:null,new:null};(a=n?d._idb.open(e,n):d._idb.open(e)).onerror=function(e){t({error:a.error,event:e,request:a})},a.onsuccess=function(e){d._db=a.result,t(null,{db:a.result,request:a,event:e,upgrade:o,initial:l,versions:u})},a.onupgradeneeded=function(e){o=!0,r.default.log(r.default.LEVEL_WARN,i.default.IDB_WILL_UPGRADE,{}),d._db=e.target.result;var t=e.target.transaction;function n(e,t,n){e.indexNames.contains(t)||e.createIndex(t,t,n)}var a=void 0;0!=e.oldVersion&&e.oldVersion!=e.newVersion?(u.old=e.oldVersion,u.new=e.newVersion,a=t.objectStore("files")):(l=!0,a=d._db.createObjectStore("files",{keyPath:"filename"})),n(a,"filename",{unique:!1}),n(a,"modified",{unique:!1})}}},{key:"persist",value:function(){return new Promise(function(e,t){return d._init?navigator.storage&&navigator.storage.persist?void navigator.storage.persist().then(function(t){return t?(r.default.log(r.default.LEVEL_INFO,i.default.IDB_PERSIST_PASS,{persistent:!0,canPersist:!0}),e({persistent:!0,canPersist:!0})):(r.default.log(r.default.LEVEL_WARN,i.default.IDB_PERSIST_FAIL,{persistent:!1,canPersist:!0}),e({persistent:!1,canPersist:!0}))}):(r.default.log(r.default.LEVEL_WARN,i.default.IDB_PERSIST_NONE,{persistent:!1,canPersist:!1}),e({persistent:!1,canPersist:!1})):(r.default.log(r.default.LEVEL_ERROR,i.default.IDB_NOT_INIT,{method:"persist"}),t({message:i.default.IDB_NOT_INIT,init:!1}))})}},{key:"save",value:function(e,t,n){return new Promise(function(a,o){if(!d._init)return r.default.log(r.default.LEVEL_ERROR,i.default.IDB_NOT_INIT,{method:"save"}),o({init:!1});if(!e||"string"!=typeof e||e.length<1)return r.default.log(r.default.LEVEL_ERROR,i.default.IDB_BAD_FILENAME,{invalidFilename:!0}),o({init:!0,invalidFilename:!0});var l=d._createFileToSave({filename:e,contents:t,mimeType:n});if(!l)return r.default.log(r.default.LEVEL_ERROR,i.default.IDB_WRONG_CONTENT,{invalidContents:!0}),o({init:!0,invalidContents:!0});var u=d._db.transaction(["files"],IDBTransaction.READ_WRITE||"readwrite"),s=u.objectStore("files").put(l._toIDB());s.onsuccess=function(e){return r.default.log(r.default.LEVEL_INFO,i.default.IDB_SAVE_SUCCESS,{file:l,e:e}),a(l)},s.onerror=function(e){return r.default.log(r.default.LEVEL_ERROR,i.default.IDB_SAVE_FAIL,{e:e}),o({init:!0,dbError:!0,errorText:u.error})}})}},{key:"load",value:function(e){return new Promise(function(t,n){if(!d._init)return r.default.log(r.default.LEVEL_ERROR,i.default.IDB_NOT_INIT,{method:"load"}),n({init:!1});if(!e||"string"!=typeof e||e.length<1)return r.default.log(r.default.LEVEL_ERROR,i.default.IDB_BAD_FILENAME,{invalidFilename:!0}),n({init:!0,invalidFilename:!0});var a=d._db.transaction(["files"]),o=a.objectStore("files").get(e);o.onsuccess=function(e){if(o.result){var a=new l.default(o.result);return r.default.log(r.default.LEVEL_INFO,i.default.IDB_LOAD_SUCCESS,{file:a,e:e}),t(a)}return r.default.log(r.default.LEVEL_ERROR,i.default.IDB_LOAD_FIND_FAIL,{e:e}),n({init:!0,notFound:!0})},o.onerror=function(e){return r.default.log(r.default.LEVEL_ERROR,i.default.IDB_LOAD_FAIL,{e:e}),n({init:!0,dbError:!0,errorText:a.error})}})}},{key:"loadAll",value:function(e){var t=(e=e||{}).onSuccess||s,n=e.onFail||s;if(!d._init)return r.default.log(r.default.LEVEL_ERROR,i.default.IDB_NOT_INIT,{method:"loadAll"}),void n({message:i.default.IDB_NOT_INIT});var a=d._db.transaction(["files"],IDBTransaction.READ_WRITE||"readwrite").objectStore("files");if(a.getAll){var o=a.getAll();o.onsuccess=function(e){var n=[];if(e.target.result[0])for(var a in e.target.result)e.target.result[a]&&e.target.result[a].filename&&n.push(new l.default(e.target.result[a]));else e.target.result&&e.target.result.filename&&n.push(new l.default(e.target.result));r.default.log(r.default.LEVEL_INFO,i.default.IDB_LOAD_ALL_SUCCESS,{files:n,event:e,request:o}),t(n,{message:i.default.IDB_LOAD_ALL_SUCCESS,event:e,request:o})},o.onerror=function(e){r.default.log(r.default.LEVEL_ERROR,i.default.IDB_LOAD_ALL_FAIL,{event:e,request:o,errors:{db:!0}}),n({message:i.default.IDB_LOAD_ALL_FAIL,event:e,request:o,errors:{db:!0}})}}else{var u=[],f=a.openCursor();f.onsuccess=function(e){var n=e.target.result;n?(n.value&&n.value.filename&&u.push(new l.default(n.value)),n.continue()):(r.default.log(r.default.LEVEL_INFO,i.default.IDB_LOAD_ALL_SUCCESS,{files:u,event:e,request:f}),t(u,{message:i.default.IDB_LOAD_ALL_SUCCESS,event:e,request:f}))},f.onerror=function(e){r.default.log(r.default.LEVEL_ERROR,i.default.IDB_LOAD_ALL_FAIL,{event:e,request:f,errors:{db:!0}}),n({message:i.default.IDB_LOAD_ALL_FAIL,event:e,request:f,errors:{db:!0}})}}}},{key:"delete",value:function(e){var t=(e=e||{}).onSuccess||s,n=e.onFail||s,a=e.filename;if(!d._init)return r.default.log(r.default.LEVEL_ERROR,i.default.IDB_NOT_INIT,{method:"delete"}),void n({message:i.default.IDB_NOT_INIT});if(!a||"string"!=typeof a||a.length<1)return r.default.log(r.default.LEVEL_ERROR,i.default.IDB_BAD_FILENAME,{errors:{filename:!0}}),void n({message:i.default.IDB_BAD_FILENAME,errors:{filename:!0}});var o=d._db.transaction(["files"],IDBTransaction.READ_WRITE||"readwrite"),l=o.objectStore("files").delete(a);o.oncomplete=function(e){r.default.log(r.default.LEVEL_INFO,i.default.IDB_DELETE_SUCCESS,{event:e,request:l,transaction:o}),t({message:i.default.IDB_DELETE_SUCCESS,event:e,request:l,transaction:o})},o.onerror=function(e){r.default.log(r.default.LEVEL_ERROR,i.default.IDB_DELETE_FAIL,{error:o.error,event:e,request:l}),n({message:i.default.IDB_DELETE_FAIL,error:o.error,event:e,request:l})}}},{key:"deleteAll",value:function(e){var t=(e=e||{}).onSuccess||s,n=e.onFail||s;if(!d._init)return r.default.log(r.default.LEVEL_ERROR,i.default.IDB_NOT_INIT,{method:"delete"}),void n({message:i.default.IDB_NOT_INIT});var a=d._db.transaction(["files"],IDBTransaction.READ_WRITE||"readwrite"),o=a.objectStore("files").clear();a.oncomplete=function(e){r.default.log(r.default.LEVEL_INFO,i.default.IDB_DELETE_ALL_SUCCESS,{event:e,request:o}),t({message:i.default.IDB_DELETE_ALL_SUCCESS,event:e,request:o})},a.onerror=function(e){r.default.log(r.default.LEVEL_ERROR,i.default.IDB_DELETE_ALL_FAIL,{error:a.error,event:e,request:o}),n({message:i.default.IDB_DELETE_ALL_FAIL,error:a.error,event:e,request:o})}}},{key:"_createFileToSave",value:function(e){var t=e.filename,n=e.contents,a=e.mimeType;if(a&&"string"==typeof a&&""!=a||(a=null),n){var o=this._getExtension(t),u=this._getMimeType(o),s=a&&"string"==typeof a&&""!=a?a:null,d=null;if("string"==typeof n)s?d=new Blob([n],{type:s}):o&&u?d=new Blob([n],{type:u}):(r.default.log(r.default.LEVEL_WARN,i.default.NO_MIME_TYPE,{filename:t,contents:n,mimeType:a,method:"_createBlobToSave"}),d=new Blob([n],{type:"text/plain"}));else if(n instanceof Blob)""==n.type?s?d=new Blob([n],{type:s}):u?d=new Blob([n],{type:u}):(r.default.log(r.default.LEVEL_WARN,i.default.NO_MIME_TYPE,{filename:t,contents:n,mimeType:a,method:"_createBlobToSave"}),d=new Blob([n],{type:"application/octet-stream"})):d=s?new Blob([n],{type:s}):n;else{if(!(n instanceof l.default))return null;s?d=new Blob([n.blob],{type:s}):u?d=new Blob([n.blob],{type:u}):(r.default.log(r.default.LEVEL_WARN,i.default.NO_MIME_TYPE,{filename:t,contents:n,mimeType:a,method:"_createBlobToSave"}),d=new Blob([n.blob],{type:"application/octet-stream"}))}return new l.default({filename:t,blob:d,lastModified:(new Date).getTime(),extension:o,size:d.size})}}},{key:"_getExtension",value:function(e){var t=null;return-1!=e.indexOf(".")&&(t=e.split(".").pop().toLowerCase()).length<=2&&(t=null),t}},{key:"_getMimeType",value:function(e){var t=null;return e&&(t=o.default[e]),t}}]),e}();d=new f,"undefined"!=typeof window&&(window.browserFileStorage=d),t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={IDB_NOT_SUPPORTED:"Indexed DB is not supported on this browser.",IDB_NOT_INIT:"Indexed DB was not initialized. Could not call method.",IDB_ALREADY_INIT:"Indexed DB was already initialized.",IDB_OPEN_SUCCESS:"Indexed DB Opened successfully.",IDB_WILL_UPGRADE:"About to upgrade inner database structure.",IDB_PERSIST_PASS:"Asked for persistency and succeeded. Files will remain until user manually clears them.",IDB_PERSIST_FAIL:"Asked for persistency and failed. Files have default persistency, browser could remove them.",IDB_PERSIST_NONE:"Could not ask for persistency. Files have default persistency, browser could remove them.",IDB_BAD_FILENAME:"Filename is not a string, or is empty.",IDB_WRONG_CONTENT:"Content given is not valid [String, Blob, or FileAbstraction]",IDB_SAVE_SUCCESS:"Successfully saved a file to database.",IDB_SAVE_FAIL:"Failed at saving file to database.",IDB_LOAD_SUCCESS:"Successfully loaded a file from database.",IDB_LOAD_FIND_FAIL:"Could not find the file in the database.",IDB_LOAD_FAIL:"Failed at loading file from database.",IDB_LOAD_ALL_SUCCESS:"Successfully loaded all files from database.",IDB_LOAD_ALL_FAIL:"Could not load all files from the database.",IDB_DELETE_SUCCESS:"Successfully deleted a file from database.",IDB_DELETE_FAIL:"Failed at deleting file from database.",IDB_DELETE_ALL_SUCCESS:"Successfully deleted all files from database.",IDB_DELETE_ALL_FAIL:"Could not delete all files from the database.",NO_MIME_TYPE:"Cannot auto-detect mimetype for filename, setting mimetype to a safe default type"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={aac:"audio/aac",abw:"application/x-abiword",arc:"application/octet-stream",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",es:"application/ecmascript",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",js:"application/javascript",json:"application/json",mid:"audio/midi",mpeg:"video/mpeg",mp4:"video/mp4",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",otf:"font/otf",png:"image/png",pdf:"application/pdf",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/x-rar-compressed",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tiff:"image/tiff",tif:"image/tiff",ts:"application/typescript",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={DEFAULT_LEVEL:1,LEVEL_NONE:0,LEVEL_ERROR:1,LEVEL_WARN:2,LEVEL_INFO:3,PREFIX:"Browser File Storage - "};a._logLevel=a.DEFAULT_LEVEL,a.log=function(e,t,n){a._logLevel>=e&&console.log(a.PREFIX+t,n)},a.logLevel=function(e){"number"==typeof e?a._logLevel=e:"string"==typeof e?"none"==e?a._logLevel=a.LEVEL_NONE:"error"==e?a._logLevel=a.LEVEL_ERROR:"warn"==e?a._logLevel=a.LEVEL_WARN:"info"==e&&(a._logLevel=a.LEVEL_INFO):a._logLevel=a.DEFAULT_LEVEL},t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.filename=t.filename,this.lastModified=t.lastModified,this.blob=t.blob,this.extension=t.extension,this.size=t.size}return a(e,[{key:"_toIDB",value:function(){return{filename:this.filename,lastModified:this.lastModified,blob:this.blob,extension:this.extension,size:this.size}}},{key:"createURL",value:function(){return this._createdURL?this._createdURL:(this._createdURL=URL.createObjectURL(this.blob),this._createdURL)}},{key:"destroyURL",value:function(){this._createdURL&&(URL.revokeObjectURL(this._createdURL),this._createdURL=null)}},{key:"_toSomething",value:function(e){var t=this;return new Promise(function(n,a){if(!FileReader)return a({supported:!1});var i=new FileReader;if(!t.blob)return a({supported:!0,fileError:!0});i.addEventListener("loadend",function(e){return n(e.srcElement.result)}),i.addEventListener("error",function(e){return a({supported:!0,readError:!0,e:e})}),i[e](t.blob)})}},{key:"toString",value:function(){return this._toSomething("readAsText")}},{key:"toBinaryString",value:function(){return this._toSomething("readAsBinaryString")}},{key:"toArrayBuffer",value:function(){return this._toSomething("readAsArrayBuffer")}},{key:"toDataURL",value:function(){return this._toSomething("readAsDataURL")}}]),e}();t.default=i}])});