!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=s(n(1)),i=s(n(2)),l=s(n(3)),r=s(n(4));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){},d=null,f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._init=!1,this._idb=null,this._db=null,this._namespace=null,this._idb_name="BROWSER_FILE_STORAGE_JS",this._idb_version=3,this._idb=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction||{READ_WRITE:"readwrite"},window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange}return o(e,[{key:"logLevel",value:function(e){l.default.logLevel(e)}},{key:"_log",value:function(e,t,n){l.default.log(e,t,n)}},{key:"init",value:function(e){var t=(e=e||{}).namespace,n=e.onSuccess||u,o=e.onFail||u;if(d._init)return d._log(l.default.LEVEL_ERROR,a.default.IDB_ALREADY_INIT,{}),void o({message:a.default.IDB_ALREADY_INIT,supported:!0});d._namespace=t;var i=t&&"string"==typeof t?d._idb_name+"_"+t:d._idb_name;d._idb?d._opendb(i,function(e,t){if(e)return d._log(l.default.LEVEL_ERROR,a.default.IDB_COULD_NOT_OPEN,{err:e}),void o({message:a.default.IDB_COULD_NOT_OPEN,error:e.error,supported:!0});d._log(l.default.LEVEL_INFO,a.default.IDB_OPEN_SUCCESS,t||{}),d._init=!0,n({message:a.default.IDB_OPEN_SUCCESS,supported:!0,initial:t.initial,upgrade:t.upgrade,versions:t.versions})},d._idb_version):(d._log(l.default.LEVEL_ERROR,a.default.IDB_NOT_SUPPORTED,{}),o({message:a.default.IDB_NOT_SUPPORTED,supported:!1}))}},{key:"_opendb",value:function(e,t,n){var o=this,i=null,r=!1,s=!1,u={old:null,new:null};(i=n?this._idb.open(e,n):this._idb.open(e)).onerror=function(e){t({error:i.error,event:e,request:i})},i.onsuccess=function(e){o._db=i.result,t(null,{db:i.result,request:i,event:e,upgrade:r,initial:s,versions:u})},i.onupgradeneeded=function(e){r=!0,o._log(l.default.LEVEL_WARN,a.default.IDB_WILL_UPGRADE,{}),o._db=e.target.result;var t=e.target.transaction;function n(e,t,n){e.indexNames.contains(t)||e.createIndex(t,t,n)}var i=void 0;0!=e.oldVersion&&e.oldVersion!=e.newVersion?(u.old=e.oldVersion,u.new=e.newVersion,i=t.objectStore("files")):(s=!0,i=o._db.createObjectStore("files",{keyPath:"filename"})),n(i,"filename",{unique:!1}),n(i,"modified",{unique:!1})}}},{key:"persist",value:function(e){var t=(e=e||{}).onSuccess||u,n=e.onFail||u;if(!d._init)return d._log(l.default.LEVEL_ERROR,a.default.IDB_NOT_INIT,{method:"persist"}),void n({message:a.default.IDB_NOT_INIT,method:"persist"});navigator.storage&&navigator.storage.persist?navigator.storage.persist().then(function(e){e?(d._log(l.default.LEVEL_INFO,a.default.IDB_PERSIST_PASS,{}),t({message:a.default.IDB_PERSIST_PASS,persistent:!0})):(d._log(l.default.LEVEL_WARN,a.default.IDB_PERSIST_FAIL,{}),n({message:a.default.IDB_PERSIST_FAIL,canPersist:!0}))}):(d._log(l.default.LEVEL_ERROR,a.default.IDB_PERSIST_NONE,{}),n({message:a.default.IDB_PERSIST_NONE,canPersist:!1}))}},{key:"save",value:function(e){var t=(e=e||{}).onSuccess||u,n=e.onFail||u,o=e.content,i=e.filename,r=e.mimeType;if(!d._init)return d._log(l.default.LEVEL_ERROR,a.default.IDB_NOT_INIT,{method:"save"}),void n({message:a.default.IDB_NOT_INIT});if(!i||"string"!=typeof i||i.length<1)return d._log(l.default.LEVEL_ERROR,a.default.IDB_BAD_FILENAME,{errors:{filename:!0}}),void n({message:a.default.IDB_BAD_FILENAME,errors:{filename:!0}});if(!o)return d._log(l.default.LEVEL_ERROR,a.default.IDB_NO_CONTENT,{errors:{filename:!1,content:!0}}),void n({message:a.default.IDB_NO_CONTENT,errors:{filename:!1,content:!0}});var s=d._createFileToSave({filename:i,content:o,mimeType:r});if(!s)return d._log(l.default.LEVEL_ERROR,a.default.IDB_WRONG_CONTENT,{errors:{filename:!1,content:!0,parseToBlob:!0}}),void n({message:a.default.IDB_WRONG_CONTENT,errors:{filename:!1,content:!0,parseToBlob:!0}});var f=d._db.transaction(["files"],IDBTransaction.READ_WRITE||"readwrite").objectStore("files").put(s._toIDB());f.onsuccess=function(e){d._log(l.default.LEVEL_INFO,a.default.IDB_SAVE_SUCCESS,{event:e}),t({message:a.default.IDB_SAVE_SUCCESS,event:e})},f.onerror=function(e){d._log(l.default.LEVEL_ERROR,a.default.IDB_SAVE_FAIL,{event:e}),n({message:a.default.IDB_SAVE_FAIL,event:e,errors:{db:!0}})}}},{key:"load",value:function(e){var t=(e=e||{}).onSuccess||u,n=e.onFail||u,o=e.filename;if(!d._init)return d._log(l.default.LEVEL_ERROR,a.default.IDB_NOT_INIT,{method:"load"}),void n({message:a.default.IDB_NOT_INIT});if(!o||"string"!=typeof o||o.length<1)return d._log(l.default.LEVEL_ERROR,a.default.IDB_BAD_FILENAME,{method:"load",filename:o}),void n({message:a.default.IDB_BAD_FILENAME,errors:{filename:!0}});var i=d._db.transaction(["files"]).objectStore("files").get(o);i.onsuccess=function(e){if(i.result){var o=new r.default(i.result);d._log(l.default.LEVEL_INFO,a.default.IDB_LOAD_SUCCESS,{file:o,event:e,request:i}),t(o,{event:e,request:i})}else d._log(l.default.LEVEL_ERROR,a.default.IDB_LOAD_FIND_FAIL,{event:e,request:i,errors:{notFound:!0}}),n({message:a.default.IDB_LOAD_FIND_FAIL,event:e,request:i,errors:{notFound:!0}})},i.onerror=function(e){d._log(l.default.LEVEL_ERROR,a.default.IDB_LOAD_FAIL,{event:e,request:i,errors:{db:!0}}),n({message:a.default.IDB_LOAD_FAIL,event:e,request:i,errors:{db:!0}})}}},{key:"loadAll",value:function(e){var t=(e=e||{}).onSuccess||u,n=e.onFail||u;if(!d._init)return d._log(l.default.LEVEL_ERROR,a.default.IDB_NOT_INIT,{method:"loadAll"}),void n({message:a.default.IDB_NOT_INIT});var o=d._db.transaction(["files"],IDBTransaction.READ_WRITE||"readwrite").objectStore("files");if(o.getAll){var i=o.getAll();i.onsuccess=function(e){var n=[];if(e.target.result[0])for(var o in e.target.result)n.push(new r.default(e.target.result[o]));else n.push(new r.default(e.target.result));l.default.log(l.default.LEVEL_INFO,a.default.IDB_LOAD_ALL_SUCCESS,{files:n,event:e,request:i}),t(n,{message:a.default.IDB_LOAD_ALL_SUCCESS,event:e,request:i})},i.onerror=function(e){l.default.log(l.default.LEVEL_ERROR,a.default.IDB_LOAD_ALL_FAIL,{event:e,request:i,errors:{db:!0}}),n({message:a.default.IDB_LOAD_ALL_FAIL,event:e,request:i,errors:{db:!0}})}}}},{key:"_createFileToSave",value:function(e){var t=e.filename,n=e.content,o=e.mimeType;o&&"string"==typeof o&&""!=o||(o=null);var i=this._getExtension(t),s=this._getMimeType(i),u=o&&"string"==typeof o&&""!=o?o:null,d=null;if("string"==typeof n)u?d=new Blob([n],{type:u}):i&&s?d=new Blob([n],{type:s}):(this._log(l.default.LEVEL_WARN,a.default.NO_MIME_TYPE,{filename:t,content:n,mimeType:o,method:"_createBlobToSave"}),d=new Blob([n],{type:"text/plain"}));else{if(!(n instanceof Blob))return null;""==n.type?u?d=new Blob([n],{type:u}):s?d=new Blob([n],{type:s}):(this._log(l.default.LEVEL_WARN,a.default.NO_MIME_TYPE,{filename:t,content:n,mimeType:o,method:"_createBlobToSave"}),d=new Blob([n],{type:"application/octet-stream"})):d=u?n:new Blob([n],{type:u})}return new r.default({filename:t,blob:d,lastModified:(new Date).getTime(),extension:i,size:d.size})}},{key:"_getExtension",value:function(e){var t=null;return-1!=e.indexOf(".")&&(t=e.split(".").pop().toLowerCase()).length<=2&&(t=null),t}},{key:"_getMimeType",value:function(e){var t=null;return e&&(t=i.default[e]),t}}]),e}();d=new f,"undefined"!=typeof window&&(window.browserFileStorage=d),t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={IDB_NOT_SUPPORTED:"Indexed DB is not supported on this browser.",IDB_NOT_INIT:"Indexed DB was not initialized. Could not call method.",IDB_ALREADY_INIT:"Indexed DB was already initialized.",IDB_OPEN_SUCCESS:"Indexed DB Opened successfully.",IDB_WILL_UPGRADE:"About to upgrade inner database structure.",IDB_PERSIST_PASS:"Asked for persistency and succeeded. Files will remain until user manually clears them.",IDB_PERSIST_FAIL:"Asked for persistency and failed. Files have default persistency, browser could remove them.",IDB_PERSIST_NONE:"Could not ask for persistency. Files have default persistency, browser could remove them.",IDB_BAD_FILENAME:"Filename is not a string, or is empty.",IDB_NO_CONTENT:"No Content specified.",IDB_WRONG_CONTENT:"Content given is not a string nor blob",IDB_SAVE_SUCCESS:"Successfully saved a file to database.",IDB_SAVE_FAIL:"Failed at saving file to database.",IDB_LOAD_SUCCESS:"Successfully loaded a file from database.",IDB_LOAD_FIND_FAIL:"Could not find the file in the database.",IDB_LOAD_FAIL:"Failed at loading file from database.",IDB_LOAD_ALL_SUCCESS:"Successfully loaded all files from database.",IDB_LOAD_ALL_FAIL:"Could not load all files from the database.",NO_MIME_TYPE:"Cannot auto-detect mimetype for filename, setting mimetype to a safe default type"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={aac:"audio/aac",abw:"application/x-abiword",arc:"application/octet-stream",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",es:"application/ecmascript",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",js:"application/javascript",json:"application/json",mid:"audio/midi",mpeg:"video/mpeg",mp4:"video/mp4",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",otf:"font/otf",png:"image/png",pdf:"application/pdf",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/x-rar-compressed",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tiff:"image/tiff",tif:"image/tiff",ts:"application/typescript",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={DEFAULT_LEVEL:1,LEVEL_NONE:0,LEVEL_ERROR:1,LEVEL_WARN:2,LEVEL_INFO:3,PREFIX:"Browser File Storage - "};o._logLevel=o.DEFAULT_LEVEL,o.log=function(e,t,n){o._logLevel>=e&&console.log(o.PREFIX+t,n)},o.logLevel=function(e){"number"==typeof e?o._logLevel=e:"string"==typeof e?"none"==e?o._logLevel=o.LEVEL_NONE:"error"==e?o._logLevel=o.LEVEL_ERROR:"warn"==e?o._logLevel=o.LEVEL_WARN:"info"==e&&(o._logLevel=o.LEVEL_INFO):o._logLevel=o.DEFAULT_LEVEL},t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.filename=t.filename,this.lastModified=t.lastModified,this.blob=t.blob,this.ext=t.extension,this.size=t.size}return o(e,[{key:"_toIDB",value:function(){return{filename:this.filename,lastModified:this.lastModified,blob:this.blob,ext:this.ext,size:this.size}}},{key:"createURL",value:function(){return this._createdURL?this._createdURL:(this._createdURL=URL.createObjectURL(this.blob),this._createdURL)}},{key:"destroyURL",value:function(){this._createdURL&&(URL.revokeObjectURL(this._createdURL),this._createdURL=null)}}]),e}();t.default=a}])});