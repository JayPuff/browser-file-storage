!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("browser-file-storage",[],t):"object"==typeof exports?exports["browser-file-storage"]=t():e["browser-file-storage"]=t()}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=i(n(1)),l=i(n(2)),a=i(n(3));function i(e){return e&&e.__esModule?e:{default:e}}var u="BROWSER_FILE_STORAGE_JS",s=2,d=null,_=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._init=!1,this._idb=null,this._db=null,this._namespace=null,this._idb=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction||{READ_WRITE:"readwrite"},window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange}return o(e,[{key:"logLevel",value:function(e){a.default.logLevel(e)}},{key:"_log",value:function(e,t,n){a.default.log(e,t,n)}},{key:"init",value:function(e){var t=e.namespace,n=e.onSuccess,o=e.onFail;if(d._init)return d._log(a.default.LEVEL_ERROR,r.default.IDB_ALREADY_INIT,{}),void o({message:r.default.IDB_ALREADY_INIT,supported:!0});d._namespace=t;var l=t&&"string"==typeof t?u+"_"+t:u;d._idb?d._opendb(l,function(e,t){if(e)return d._log(a.default.LEVEL_ERROR,r.default.IDB_COULD_NOT_OPEN,{err:e}),void o({message:r.default.IDB_COULD_NOT_OPEN,error:e.error,supported:!0});d._log(a.default.LEVEL_INFO,r.default.IDB_OPEN_SUCCESS,t||{}),d._init=!0,n({message:r.default.IDB_OPEN_SUCCESS,supported:!0,initial:t.initial,upgrade:t.upgrade,versions:t.versions})},s):(d._log(a.default.LEVEL_ERROR,r.default.IDB_NOT_SUPPORTED,{}),o({message:r.default.IDB_NOT_SUPPORTED,supported:!1}))}},{key:"_opendb",value:function(e,t,n){var o=this,l=null,i=!1,u=!1,s={old:null,new:null};(l=n?this._idb.open(e,n):this._idb.open(e)).onerror=function(e){t({error:l.error,event:e,request:l})},l.onsuccess=function(e){o._db=l.result,t(null,{db:l.result,request:l,event:e,upgrade:i,initial:u,versions:s})},l.onupgradeneeded=function(e){i=!0,o._log(a.default.LEVEL_WARN,r.default.IDB_WILL_UPGRADE,{}),o._db=e.target.result;var t=e.target.transaction;function n(e,t,n){e.indexNames.contains(t)||e.createIndex(t,t,n)}var l=void 0;0!=e.oldVersion&&e.oldVersion!=e.newVersion?(s.old=e.oldVersion,s.new=e.newVersion,l=t.objectStore("files")):(u=!0,l=o._db.createObjectStore("files",{keyPath:"path"})),n(l,"name",{unique:!1}),n(l,"modified",{unique:!1})}}},{key:"persist",value:function(e){var t=e.onSuccess,n=e.onFail;if(!d._init)return d._log(a.default.LEVEL_ERROR,r.default.IDB_NOT_INIT,{method:"persist"}),void n({message:r.default.IDB_NOT_INIT,method:"persist"});navigator.storage&&navigator.storage.persist?navigator.storage.persist().then(function(e){e?(d._log(a.default.LEVEL_INFO,r.default.IDB_PERSIST_PASS,{}),t({message:r.default.IDB_PERSIST_PASS,persistent:!0})):(d._log(a.default.LEVEL_WARN,r.default.IDB_PERSIST_FAIL,{}),n({message:r.default.IDB_PERSIST_FAIL,canPersist:!0}))}):(d._log(a.default.LEVEL_ERROR,r.default.IDB_PERSIST_NONE,{}),n({message:r.default.IDB_PERSIST_NONE,canPersist:!1}))}},{key:"save",value:function(e){var t=e.filename,n=e.content,o=e.onSuccess,l=e.onFail,i=e.mimeType;if(!d._init)return d._log(a.default.LEVEL_ERROR,r.default.IDB_NOT_INIT,{method:"save"}),void l({message:r.default.IDB_NOT_INIT});if(!t||"string"!=typeof t||t.length<1)return d._log(a.default.LEVEL_ERROR,r.default.IDB_BAD_FILENAME,{errors:{filename:!0}}),void l({message:r.default.IDB_BAD_FILENAME,errors:{filename:!0}});if(!n)return d._log(a.default.LEVEL_ERROR,r.default.IDB_NO_CONTENT,{errors:{filename:!1,content:!0}}),void l({message:r.default.IDB_NO_CONTENT,errors:{filename:!1,content:!0}});var u=d._createBlobToSave({filename:t,content:n,mimeType:i});if(!u)return d._log(a.default.LEVEL_ERROR,r.default.IDB_WRONG_CONTENT,{errors:{filename:!1,content:!0,parseToBlob:!0}}),void l({message:r.default.IDB_WRONG_CONTENT,errors:{filename:!1,content:!0,parseToBlob:!0}});var s=d._db.transaction(["files"],IDBTransaction.READ_WRITE||"readwrite").objectStore("files").put({path:t,lastModified:(new Date).getTime(),blob:u});s.onsuccess=function(e){d._log(a.default.LEVEL_INFO,r.default.IDB_SAVE_SUCCESS,{event:e}),o({message:r.default.IDB_SAVE_SUCCESS,event:e})},s.onerror=function(e){d._log(a.default.LEVEL_ERROR,r.default.IDB_SAVE_FAIL,{event:e}),l({message:r.default.IDB_SAVE_FAIL,event:e,errors:{db:!0}})}}},{key:"load",value:function(e){var t=e.filename,n=e.onSuccess,o=e.onFail;if(!d._init)return d._log(a.default.LEVEL_ERROR,r.default.IDB_NOT_INIT,{method:"load"}),void o({message:r.default.IDB_NOT_INIT});if(!t||"string"!=typeof t||t.length<1)return d._log(a.default.LEVEL_ERROR,r.default.IDB_BAD_FILENAME,{method:"load",filename:t}),void o({message:r.default.IDB_BAD_FILENAME,errors:{filename:!0}});var l=d._db.transaction(["files"]).objectStore("files").get(t);l.onsuccess=function(e){l.result?(d._log(a.default.LEVEL_INFO,r.default.IDB_LOAD_SUCCESS,{event:e,request:l}),n(l.result,{event:e,request:l})):(d._log(a.default.LEVEL_ERROR,r.default.IDB_LOAD_FIND_FAIL,{event:e,request:l,errors:{notFound:!0}}),o({message:r.default.IDB_LOAD_FIND_FAIL,event:e,request:l,errors:{notFound:!0}}))},l.onerror=function(e){d._log(a.default.LEVEL_ERROR,r.default.IDB_LOAD_FAIL,{event:e,request:l,errors:{db:!0}}),o({message:r.default.IDB_LOAD_FAIL,event:e,request:l,errors:{db:!0}})}}},{key:"_createBlobToSave",value:function(e){var t=e.filename,n=e.content,o=e.mimeType;o&&"string"==typeof o&&""!=o||(o=null);var l=this._getExtension(t),i=this._getMimeType(l),u=o&&"string"==typeof o&&""!=o?o:null,s=null;if("string"==typeof n)u?s=new Blob([n],{type:u}):l&&i?s=new Blob([n],{type:i}):(this._log(a.default.LEVEL_WARN,r.default.NO_MIME_TYPE,{filename:t,content:n,mimeType:o,method:"_createBlobToSave"}),s=new Blob([n]));else{if(!(n instanceof Blob))return null;""==n.type?u?s=new Blob([n],{type:u}):i?s=new Blob([n],{type:i}):(this._log(a.default.LEVEL_WARN,r.default.NO_MIME_TYPE,{filename:t,content:n,mimeType:o,method:"_createBlobToSave"}),s=new Blob([n])):s=u?n:new Blob([n],{type:u})}return s}},{key:"_getExtension",value:function(e){var t=null;return-1!=e.indexOf(".")&&(t=e.split(".").pop().toLowerCase()).length<=2&&(t=null),t}},{key:"_getMimeType",value:function(e){var t=null;return e&&(t=l.default[e]),t}}]),e}();d=new _,"undefined"!=typeof window&&(window.browserFileStorage=d),t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={IDB_NOT_SUPPORTED:"Indexed DB is not supported on this browser.",IDB_NOT_INIT:"Indexed DB was not initialized. Could not call method.",IDB_ALREADY_INIT:"Indexed DB was already initialized.",IDB_OPEN_SUCCESS:"Indexed DB Opened successfully.",IDB_WILL_UPGRADE:"About to upgrade inner database structure.",IDB_PERSIST_PASS:"Asked for persistency and succeeded. Files will remain until user manually clears them.",IDB_PERSIST_FAIL:"Asked for persistency and failed. Files have default persistency, browser could remove them.",IDB_PERSIST_NONE:"Could not ask for persistency. Files have default persistency, browser could remove them.",IDB_BAD_FILENAME:"Filename is not a string, or is empty.",IDB_NO_CONTENT:"No Content specified.",IDB_WRONG_CONTENT:"Content given is not a string nor blob",IDB_SAVE_SUCCESS:"Successfully saved a file to database.",IDB_SAVE_FAIL:"Failed at saving file to database.",IDB_LOAD_SUCCESS:"Successfully loaded a file from database.",IDB_LOAD_FIND_FAIL:"Could not find the file in the database.",IDB_LOAD_FAIL:"Failed at loading file from database.",NO_MIME_TYPE:"File saved with no mimetype."}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={json:"application/json"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={DEFAULT_LEVEL:1,LEVEL_NONE:0,LEVEL_ERROR:1,LEVEL_WARN:2,LEVEL_INFO:3,PREFIX:"Browser File Storage - "};o._logLevel=o.DEFAULT_LEVEL,o.log=function(e,t,n){o._logLevel>=e&&console.log(o.PREFIX+t,n)},o.logLevel=function(e){"number"==typeof e?o._logLevel=e:"string"==typeof e?"none"==e?o._logLevel=o.LEVEL_NONE:"error"==e?o._logLevel=o.LEVEL_ERROR:"warn"==e?o._logLevel=o.LEVEL_WARN:"info"==e&&(o._logLevel=o.LEVEL_INFO):o._logLevel=o.DEFAULT_LEVEL},t.default=o}])});