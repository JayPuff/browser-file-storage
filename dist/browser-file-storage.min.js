!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=u(n(1)),a=u(n(2)),r=u(n(3)),l=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var d=null,f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._init=!1,this._idb=null,this._db=null,this._namespace=null,this._idb_name="BROWSER_FILE_STORAGE_JS",this._idb_version=3,this._idb=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction||{READ_WRITE:"readwrite"},window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange}return i(e,[{key:"logLevel",value:function(e){r.default.logLevel(e)}},{key:"init",value:function(e){return new Promise(function(t,n){if(d._init)return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_ALREADY_INIT,{}),n({alreadyInit:!0,supported:!0});if(!d._idb)return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_NOT_SUPPORTED,{}),n({supported:!1});var i=e&&"string"==typeof e?d._idb_name+"_"+e:d._idb_name;d._opendb(i,function(e,i){return e?(r.default.log(r.default.LEVEL_ERROR,o.default.IDB_COULD_NOT_OPEN,{dbError:!0,error:e.error,e:e}),n({dbError:!0,error:e.error,supported:!0})):(d._init=!0,r.default.log(r.default.LEVEL_INFO,o.default.IDB_OPEN_SUCCESS,{}),t({initial:i.initial,supported:!0}))},d._idb_version)})}},{key:"persist",value:function(){return new Promise(function(e,t){return d._init?navigator.storage&&navigator.storage.persist?void navigator.storage.persist().then(function(t){return t?(r.default.log(r.default.LEVEL_INFO,o.default.IDB_PERSIST_PASS,{persistent:!0,canPersist:!0}),e({persistent:!0,canPersist:!0})):(r.default.log(r.default.LEVEL_WARN,o.default.IDB_PERSIST_FAIL,{persistent:!1,canPersist:!0}),e({persistent:!1,canPersist:!0}))}):(r.default.log(r.default.LEVEL_WARN,o.default.IDB_PERSIST_NONE,{persistent:!1,canPersist:!1}),e({persistent:!1,canPersist:!1})):(r.default.log(r.default.LEVEL_ERROR,o.default.IDB_NOT_INIT,{method:"persist"}),t({message:o.default.IDB_NOT_INIT,init:!1}))})}},{key:"save",value:function(e,t,n){return new Promise(function(i,a){if(!d._init)return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_NOT_INIT,{method:"save"}),a({init:!1});if(!e||"string"!=typeof e||e.length<1)return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_BAD_FILENAME,{invalidFilename:!0}),a({init:!0,invalidFilename:!0});var l=d._createFileToSave({filename:e,contents:t,mimeType:n});if(!l)return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_WRONG_CONTENT,{invalidContents:!0}),a({init:!0,invalidContents:!0});var u=d._db.transaction(["files"],IDBTransaction.READ_WRITE||"readwrite").objectStore("files").put(l._toIDB());u.onsuccess=function(e){return r.default.log(r.default.LEVEL_INFO,o.default.IDB_SAVE_SUCCESS,{file:l,e:e}),i(l)},u.onerror=function(e){return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_SAVE_FAIL,{e:e}),a({init:!0,dbError:!0,error:u.error})}})}},{key:"load",value:function(e){return new Promise(function(t,n){if(!d._init)return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_NOT_INIT,{method:"load"}),n({init:!1});if(!e||"string"!=typeof e||e.length<1)return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_BAD_FILENAME,{invalidFilename:!0}),n({init:!0,invalidFilename:!0});var i=d._db.transaction(["files"]).objectStore("files").get(e);i.onsuccess=function(e){if(i.result){var a=new l.default(i.result);return r.default.log(r.default.LEVEL_INFO,o.default.IDB_LOAD_SUCCESS,{file:a,e:e}),t(a)}return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_LOAD_FIND_FAIL,{e:e}),n({init:!0,notFound:!0})},i.onerror=function(e){return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_LOAD_FAIL,{e:e}),n({init:!0,dbError:!0,error:i.error})}})}},{key:"loadAll",value:function(){return new Promise(function(e,t){if(!d._init)return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_NOT_INIT,{method:"loadAll"}),t({init:!1});var n=d._db.transaction(["files"],IDBTransaction.READ_WRITE||"readwrite").objectStore("files");if(n.getAll){var i=n.getAll();i.onsuccess=function(t){var n=[];if(t.target.result[0])for(var i in t.target.result)t.target.result[i]&&t.target.result[i].filename&&n.push(new l.default(t.target.result[i]));else t.target.result&&t.target.result.filename&&n.push(new l.default(t.target.result));return r.default.log(r.default.LEVEL_INFO,o.default.IDB_LOAD_ALL_SUCCESS,{files:n}),e(n)},i.onerror=function(e){return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_LOAD_ALL_FAIL,{e:e}),t({init:!0,dbError:!0,error:i.error})}}else{var a=[],u=n.openCursor();u.onsuccess=function(t){var n=t.target.result;if(!n)return r.default.log(r.default.LEVEL_INFO,o.default.IDB_LOAD_ALL_SUCCESS,{files:a}),e(a);n.value&&n.value.filename&&a.push(new l.default(n.value)),n.continue()},u.onerror=function(e){return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_LOAD_ALL_FAIL,{e:e}),t({init:!0,dbError:!0,error:u.error})}}})}},{key:"delete",value:function(e){return new Promise(function(t,n){if(!d._init)return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_NOT_INIT,{method:"delete"}),n({init:!1});if(!e||"string"!=typeof e||e.length<1)return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_BAD_FILENAME,{invalidFilename:!0}),n({init:!0,invalidFilename:!0});var i=d._db.transaction(["files"],IDBTransaction.READ_WRITE||"readwrite");i.objectStore("files").delete(e);i.oncomplete=function(e){return r.default.log(r.default.LEVEL_INFO,o.default.IDB_DELETE_SUCCESS,{}),t()},i.onerror=function(e){return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_DELETE_FAIL,{e:e}),n({init:!0,dbError:!0,error:i.error})}})}},{key:"deleteAll",value:function(){return new Promise(function(e,t){if(!d._init)return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_NOT_INIT,{method:"deleteAll"}),t({init:!1});var n=d._db.transaction(["files"],IDBTransaction.READ_WRITE||"readwrite");n.objectStore("files").clear();n.oncomplete=function(t){return r.default.log(r.default.LEVEL_INFO,o.default.IDB_DELETE_ALL_SUCCESS,{}),e()},n.onerror=function(e){return r.default.log(r.default.LEVEL_ERROR,o.default.IDB_DELETE_ALL_FAIL,{e:e}),t({init:!0,dbError:!0,error:n.error})}})}},{key:"_createFileToSave",value:function(e){var t=e.filename,n=e.contents,i=e.mimeType;if(i&&"string"==typeof i&&""!=i||(i=null),n){var a=this._getExtension(t),u=this._getMimeType(a),d=i&&"string"==typeof i&&""!=i?i:null,f=null;if("string"==typeof n)d?f=new Blob([n],{type:d}):a&&u?f=new Blob([n],{type:u}):(r.default.log(r.default.LEVEL_WARN,o.default.NO_MIME_TYPE,{filename:t,contents:n,mimeType:i,method:"_createBlobToSave"}),f=new Blob([n],{type:"text/plain"}));else if(n instanceof Blob)""==n.type?d?f=new Blob([n],{type:d}):u?f=new Blob([n],{type:u}):(r.default.log(r.default.LEVEL_WARN,o.default.NO_MIME_TYPE,{filename:t,contents:n,mimeType:i,method:"_createBlobToSave"}),f=new Blob([n],{type:"application/octet-stream"})):f=d?new Blob([n],{type:d}):n;else{if(!(n instanceof l.default))return null;d?f=new Blob([n.blob],{type:d}):u?f=new Blob([n.blob],{type:u}):(r.default.log(r.default.LEVEL_WARN,o.default.NO_MIME_TYPE,{filename:t,contents:n,mimeType:i,method:"_createBlobToSave"}),f=new Blob([n.blob],{type:"application/octet-stream"}))}return new l.default({filename:t,blob:f,lastModified:(new Date).getTime(),extension:a,size:f.size,type:f.type})}}},{key:"_opendb",value:function(e,t,n){var i=null,a=!1,l=!1,u={old:null,new:null};(i=n?d._idb.open(e,n):d._idb.open(e)).onerror=function(e){t({error:i.error,event:e,request:i})},i.onsuccess=function(e){d._db=i.result,t(null,{db:i.result,request:i,event:e,upgrade:a,initial:l,versions:u})},i.onupgradeneeded=function(e){a=!0,r.default.log(r.default.LEVEL_WARN,o.default.IDB_WILL_UPGRADE,{}),d._db=e.target.result;var t=e.target.transaction;function n(e,t,n){e.indexNames.contains(t)||e.createIndex(t,t,n)}var i=void 0;0!=e.oldVersion&&e.oldVersion!=e.newVersion?(u.old=e.oldVersion,u.new=e.newVersion,i=t.objectStore("files")):(l=!0,i=d._db.createObjectStore("files",{keyPath:"filename"})),n(i,"filename",{unique:!1}),n(i,"modified",{unique:!1})}}},{key:"_getExtension",value:function(e){var t=null;return-1!=e.indexOf(".")&&(t=e.split(".").pop().toLowerCase()).length<=2&&(t=null),t}},{key:"_getMimeType",value:function(e){var t=null;return e&&(t=a.default[e]),t}}]),e}();d=new f,"undefined"!=typeof window&&(window.browserFileStorage=d),t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={IDB_NOT_SUPPORTED:"Indexed DB is not supported on this browser.",IDB_NOT_INIT:"Indexed DB was not initialized. Could not call method.",IDB_ALREADY_INIT:"Indexed DB was already initialized.",IDB_OPEN_SUCCESS:"Indexed DB Opened successfully.",IDB_WILL_UPGRADE:"About to upgrade inner database structure.",IDB_PERSIST_PASS:"Asked for persistency and succeeded. Files will remain until user manually clears them.",IDB_PERSIST_FAIL:"Asked for persistency and failed. Files have default persistency, browser could remove them.",IDB_PERSIST_NONE:"Could not ask for persistency. Files have default persistency, browser could remove them.",IDB_BAD_FILENAME:"Filename is not a string, or is empty.",IDB_WRONG_CONTENT:"Content given is not valid [String, Blob, or FileAbstraction]",IDB_SAVE_SUCCESS:"Successfully saved a file to database.",IDB_SAVE_FAIL:"Failed at saving file to database.",IDB_LOAD_SUCCESS:"Successfully loaded a file from database.",IDB_LOAD_FIND_FAIL:"Could not find the file in the database.",IDB_LOAD_FAIL:"Failed at loading file from database.",IDB_LOAD_ALL_SUCCESS:"Successfully loaded all files from database.",IDB_LOAD_ALL_FAIL:"Could not load all files from the database.",IDB_DELETE_SUCCESS:"Successfully deleted a file from database.",IDB_DELETE_FAIL:"Failed at deleting file from database.",IDB_DELETE_ALL_SUCCESS:"Successfully deleted all files from database.",IDB_DELETE_ALL_FAIL:"Could not delete all files from the database.",NO_MIME_TYPE:"Cannot auto-detect mimetype for filename, setting mimetype to a safe default type"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={aac:"audio/aac",abw:"application/x-abiword",arc:"application/octet-stream",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",es:"application/ecmascript",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",js:"application/javascript",json:"application/json",mid:"audio/midi",mpeg:"video/mpeg",mp4:"video/mp4",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",otf:"font/otf",png:"image/png",pdf:"application/pdf",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/x-rar-compressed",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tiff:"image/tiff",tif:"image/tiff",ts:"application/typescript",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={DEFAULT_LEVEL:1,LEVEL_NONE:0,LEVEL_ERROR:1,LEVEL_WARN:2,LEVEL_INFO:3,PREFIX:"Browser File Storage - "};i._logLevel=i.DEFAULT_LEVEL,i.log=function(e,t,n){i._logLevel>=e&&console.log(i.PREFIX+t,n)},i.logLevel=function(e){"number"==typeof e?i._logLevel=e:"string"==typeof e?"none"==e?i._logLevel=i.LEVEL_NONE:"error"==e?i._logLevel=i.LEVEL_ERROR:"warn"==e?i._logLevel=i.LEVEL_WARN:"info"==e&&(i._logLevel=i.LEVEL_INFO):i._logLevel=i.DEFAULT_LEVEL},t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.filename=t.filename,this.lastModified=t.lastModified,this.blob=t.blob,this.extension=t.extension,this.size=t.size,this.type=t.type}return i(e,[{key:"_toIDB",value:function(){return{filename:this.filename,lastModified:this.lastModified,blob:this.blob,extension:this.extension,size:this.size,type:this.type}}},{key:"createURL",value:function(){return this._createdURL?this._createdURL:(this._createdURL=URL.createObjectURL(this.blob),this._createdURL)}},{key:"destroyURL",value:function(){this._createdURL&&(URL.revokeObjectURL(this._createdURL),this._createdURL=null)}},{key:"_toSomething",value:function(e){var t=this;return new Promise(function(n,i){if(!FileReader)return i({supported:!1});var o=new FileReader;if(!t.blob)return i({supported:!0,fileError:!0});o.addEventListener("loadend",function(e){return n(e.srcElement.result)}),o.addEventListener("error",function(e){return i({supported:!0,readError:!0,e:e})}),o[e](t.blob)})}},{key:"toString",value:function(){return this._toSomething("readAsText")}},{key:"toBinaryString",value:function(){return this._toSomething("readAsBinaryString")}},{key:"toArrayBuffer",value:function(){return this._toSomething("readAsArrayBuffer")}},{key:"toDataURL",value:function(){return this._toSomething("readAsDataURL")}}]),e}();t.default=o}])});